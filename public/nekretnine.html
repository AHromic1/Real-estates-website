<!doctype html>
<html lang="hr">
  <head>
    <link rel="stylesheet" type="text/css" href="../css/nekretnineStil.css">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Nekretnine</title>
  </head>
  <body>
    <div class="filtriranje">
      <label for="minCijena">Minimalna cijena:</label>
      <input type="text" id="minCijena" name="minCijena" placeholder="Input Field">
      <label for="maxCijena">Maksimalna cijena:</label>
      <input type="text" id="maxCijena" name="maxCijena" placeholder="Input Field">
      <label for="minKvadratura">Minimalna kvadratura:</label>
      <input type="text" id="minKvadratura" name="minKvadratura" placeholder="Input Field">
      <label for="maxKvadratura">Maksimalna kvadratura:</label>
      <input type="text" id="maxKvadratura" name="maxKvadratura" placeholder="Input Field">
      </div>
      <button id="filtrirajBttn" >Filtriraj</button>

    <object data="menu.html" class="meniPos" id="ucitaniMeni"></object>
    <div class="alignment" id = "divNekretnine">
      <h2 class="stanPos">Stan</h2>
    <div id="stan">
    </div>
    <h2>Kuća</h2>
    <div id="kuca">
    </div>
    <h2>Poslovni prostor</h2>
    <div id="pp">
    </div>
    </div>
    <script src="scripts/MarketingAjax.js"></script>
    <script src="scripts/poziviAjax.js"></script>
   <script src="scripts/SpisakNekretnina.js"></script>
   <script src="scripts/nekretnine.js"></script>
  

    <!--prijava odjava update-->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
    const meni = document.getElementById('ucitaniMeni');
    
    meni.onload = function () {
      const meniSadrzaj = meni.contentDocument;
    
      if (meniSadrzaj) {
        const prijava = meniSadrzaj.getElementById('login');
        const odjava = meniSadrzaj.getElementById('logout');
    
    
        const isLoggedIn = localStorage.getItem('prijavljen') === 'true';
          console.log(isLoggedIn);

        meniSadrzaj.defaultView.updateMenuContent(isLoggedIn);
      }
    }
    });
    
    </script>
 <!--   
    <script>
      let urlParams = new URLSearchParams(window.location.search);
      let prijavljen = urlParams.get('prijavljen');
      console.log(prijavljen);
       document.addEventListener('DOMContentLoaded', function () {
        const meni = document.getElementById('ucitaniMeni');
        
      meni.onload = function () {
      let urlParams = new URLSearchParams(window.location.search);
      let prijavljen = urlParams.get('prijavljen');
      if(prijavljen){
        const meniSadrzaj = meni.contentDocument;
  
        if (meniSadrzaj) {
        const prijava = meniSadrzaj.getElementById('login');
        const odjava = meniSadrzaj.getElementById('logout');
        
        meniSadrzaj.defaultView.updateMenuContent(true);
        }
  }
      }});
     </script>
    -->
    
<script>
  document.addEventListener('DOMContentLoaded', function () {
const meni = document.getElementById('ucitaniMeni');

meni.onload = function () {
  const meniSadrzaj = meni.contentDocument;

  if (meniSadrzaj) {
    const prijava = meniSadrzaj.getElementById('login');
    const odjava = meniSadrzaj.getElementById('logout');

    const isLoggedIn = localStorage.getItem('prijavljen') === 'true';
      console.log(isLoggedIn);

    meniSadrzaj.defaultView.updateMenuContent(isLoggedIn);
  }
}
});

</script> 

   <!-- <script src="../poziviAjax.js"></script> -->
   

   <script>
    
    window.onload = function() {
      //var nekretnineContainer = document.getElementById('stan');
      //PoziviAjax.impl_getNekretnine()
      let spisakNekretnine = null;
      let nekretnine = SpisakNekretnina();
      PoziviAjax.getNekretnine(function (error, data) {
        if (error) {
          console.error('Error fetching nekretnine:', error);
        } else {
          
          /////////////////////////////////////////////////////////////////////////
           //instanciranje modula
          ///let nekretnine = SpisakNekretnina();
          spisakNekretnine = data;
          nekretnine.init(data, null);  //ne trebaju mi korisnici
          const divStan = document.getElementById("stan");
          const divKuca = document.getElementById("kuca");
          const divPp = document.getElementById("pp");
          spojiNekretnine(divStan, nekretnine, "Stan");
          spojiNekretnine(divKuca, nekretnine, "Kuća");
          spojiNekretnine(divPp, nekretnine, "Poslovni prostor");
          

           //const filtriraj = document.getElementById('filtrirajBttn');
/////filtriranje
   
    
      //////////
          /////////////////////////////////////////////////////////////////////////
          /*for (let i = 0; i < data.length; i++) { //testiranje
            let ime = document.createElement("p");
            ime.textContent = data[i].naziv;
            nekretninecont.appendChild(ime);
          }*/
        }
      });

      function filtriraj() {
        console.log("usao u funkciju");
        let minCijena = parseInt(document.getElementById('minCijena').value);
      let maxCijena = parseInt(document.getElementById('maxCijena').value);
      let maxKvadratura = parseInt(document.getElementById('maxKvadratura').value);
      let minKvadratura = parseInt(document.getElementById('minKvadratura').value);
      let filterBttn = document.getElementById('filtrirajBttn');
      //let kriterij = {};
      if(!maxCijena)
      maxCijena = undefined; 

      if(!minCijena)
     minCijena = undefined; 
      if(!maxKvadratura)
      maxKvadratura = undefined; 
      if(!minKvadratura)
      minKvadratura = undefined; 

      let kriterij = {
        min_cijena: minCijena,
        max_cijena: maxCijena,
        max_kvadratura: maxKvadratura,
        min_kvadratura: minKvadratura
      };
     
      console.log(kriterij);
      console.log(nekretnine);
        //let nekretnine2 = SpisakNekretnina();
         // nekretnine2.init(nekretnine.spisakNekretnine, null);  //ne trebaju mi korisnici
         // console.log("nekretnine");
         // console.log(nekretnine2);
          let filtrirane = nekretnine.filtrirajNekretnine(kriterij);
          console.log("filtrirane");
          console.log(filtrirane);
          let nekretnine2 = SpisakNekretnina();
          nekretnine2.init(filtrirane, null);
          console.log("filtrirane");
          console.log(filtrirane);
          let divStan = document.getElementById("stan");
          let divKuca = document.getElementById("kuca");
          let divPp = document.getElementById("pp");
          console.log("zavrsio je s filtriranjem, ostalo je spajanje");
          //const noveNekretnine = nekretnine2.init(filtrirane, null);
          divStan.innerHTML = '';
          divKuca.innerHTML = '';
          divPp.innerHTML = '';

          divStan = document.getElementById("stan");
          divKuca = document.getElementById("kuca");
          divPp = document.getElementById("pp");

          spojiNekretnine(divStan, nekretnine2, "Stan");
          spojiNekretnine(divKuca, nekretnine2, "Kuća");
          spojiNekretnine(divPp, nekretnine2, "Poslovni prostor");

          const idsPrikazanih = filtrirane.map(property => property.id);
          console.log("idevi", idsPrikazanih);
          MarketingAjax.marketingNekretnine({nizNekretninaIds: idsPrikazanih}, function(error, data){
            if(error){
              console.log("Doslo je do greske");
            }
            else{
              console.log("uspjesno azuriranje");
            }
          });

      };
      const bttn = document.getElementById('filtrirajBttn');
      bttn.addEventListener('click', function () {
        filtriraj();
      });
    };
  </script>

<script>
 /* const detaljiBttn = document.getElementById('detalji');
  detaljiBttn.addEventListener('click', function () {
    console.log("detalji kliknut");
    //provjera koji je id
    let id = JSON.parse(this.getAttribute("data-id"));
    console.log("id");
    console.log(id);
        MarketingAjax.marketingNekretnineId(id, function(error, data){
            if(error){
              console.log("neuspjeh");
            }
            else{
              console.log("uspjeh");
            }
        });
      });*/
</script>

  </body>
</html>
